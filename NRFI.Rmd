---
title: "NRFI Prediction Model"
author: "Bryan Jacobs\nAiden Fletcher"
date: "2025-08-08"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## NRFI Prediction Model

Goal: Predict the probability of the occurrence of a No Run First Inning given any MLB match up.

Data Set: baseballr

Model: XGBoost

Pull data from baseballr using R

potentially cleaning / feature engineering

```{r}
# Load Packages
if (!requireNamespace('pacman', quietly = TRUE)){
  install.packages('pacman')
}
pacman::p_load_current_gh("BillPetti/baseballr")

pacman::p_load(tidyverse,
               reticulate,
               purrr,
               progress)
```

```{r}
# Massive list of game IDs
game_ids <- c(718778, 718779, 718780) 

# Safe wrappers
safe_linescore <- safely(mlb_game_linescore)
safe_gameinfo  <- safely(mlb_game_info)

# Progress bar
pb <- progress_bar$new(total = length(game_ids))

# Fetch inning-by-inning data
all_games_data <- map_df(game_ids, ~ { pb$tick(); safe_linescore(.x)$result })

# Filter to inning 1, keep only pre-game predictors + outcome vars for target creation
inning_1_data <- all_games_data %>%
  filter(num == 1) %>%
  select(game_pk, 
         num, 
         home_team_name, 
         away_team_name,
         home_runs,  # will be used for NRFI target
         away_runs,
         home_team_record_wins, 
         away_team_record_wins)

# Fetch weather data
weather_data <- map_df(game_ids, ~ safe_gameinfo(.x)$result)

# Clean and rename to avoid collisions
weather_data_clean <- weather_data %>%
  select(game_pk,
         venue_name,
         temp_game = temperature,
         weather_notes = other_weather,
         wind_game = wind)

# Join, create NRFI target, drop leak columns
inning_1_weather <- inning_1_data %>%
  left_join(weather_data_clean, by = "game_pk") %>%
  mutate(NRFI = as.integer(home_runs == 0 & away_runs == 0)) %>%
  select(-home_runs, -away_runs)



```

model creation, training, testing, optimizing in Python

```{python}

```
